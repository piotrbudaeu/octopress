
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Angular directive for password matching - Software Development Ramblings</title>
	<meta name="author" content="Piotr Buda">

	
	<meta name="description" content="Angular Directive for Password Matching Recently at Bootstrap I was working on the profile page part. I had to introduce a simple validation of &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="http://feeds.feedburner.com/SoftwareDevelopmentRamblings" rel="alternate" title="Software Development Ramblings" type="application/atom+xml">
	
	<link rel="canonical" href="http://piotrbuda.eu/2013/02/angularjs-directive-for-password-matching.html">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("pibuda@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h2><a href="/">Software Development Ramblings</a></h2>
</hgroup>

<p class="subtitle">Java, Scala, Android and Stuff</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		<a class="google" href="https://plus.google.com/103946216847339531627" rel="author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/piotrbuda" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/pbuda" title="GitHub">GitHub</a>
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/piotrbuda">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="http://feeds.feedburner.com/SoftwareDevelopmentRamblings" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/piotrbuda">piotrbuda</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('piotrbuda', 4, false);
	})(jQuery);
</script>

			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Angular Directive for Password Matching</h1>
	
		<div class="entry-content" itemprop="articleBody" style="display:table-cell;vertical-align:top;padding-right:15px;"><p>Recently at <a href="http://bootstrap.softwaremill.com/#/">Bootstrap</a> I was working on the profile page part. I had to introduce a simple validation of passwords &ndash; when you type in your password, you often have to repeat it. This was implemented in a few places already, however it wasn&rsquo;t correct &ndash; changing the original password did not trigger validation.</p>

<p>To see how this works, just go to the <a href="http://bootstrap.softwaremill.com">Bootstrap page</a> and play with the registration form&rsquo;s &ldquo;password&rdquo; and &ldquo;repeat password&rdquo; inputs. All code snippets are taken from <a href="http://bootstrap.softwaremill.com/#/">Bootstrap</a>.</p>

<h3>Requirements</h3>

<p>We have two input fields and we just need to validate whether values in them are synchronized. Values entered in both these fields need to be the same, if they&rsquo;re not, then display error message next to the second input field that the contents are invalid.</p>

<h3>Simple approach</h3>

<p>When I started, there was something implemented already. It was a simple solution that based on the <a href="http://docs.angularjs.org/api/ng.directive:ngChange">ng-change</a> directive. This directive was attached to the repeated field and every time the value changed, method checkPassword() in RegisterController was called.</p>

<figure class='code'><figcaption><span>How checkPassword() was used</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">id=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;repeat password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;user.repeatPassword&quot;</span> <span class="na">ng-change=</span><span class="s">&quot;checkPassword()&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Validation in checkPassword method</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$scope</span><span class="p">.</span><span class="nx">checkPassword</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">repeatPassword</span><span class="p">.</span><span class="nx">$error</span><span class="p">.</span><span class="nx">dontMatch</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span> <span class="o">!==</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">repeatPassword</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The dontMatch error flag was then used to display error message.</p>

<figure class='code'><figcaption><span>Using dontMatch flag to display error</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;text-error&quot;</span> <span class="na">ng-show=</span><span class="s">&quot;registerForm.repeatPassword.$dirty &amp;&amp; registerForm.repeatPassword.$error.dontMatch&quot;</span><span class="nt">&gt;</span>Passwords don&#39;t match!<span class="nt">&lt;/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This isn&rsquo;t the best solution. First of all, this only checked equity upon changing the repeated field, not the original password field. To make this work it would be required in both original and repeated fields. This also wasn&rsquo;t reusable &ndash; to use it in another place, checkPassword method had to be actually copied.</p>

<h3>Angular directive to the rescue</h3>

<p>Directives in AngularJS are used to create reusable components so I thought about how to use them to solve the validation problem. It was rather easy and straightforward.</p>

<figure class='code'><figcaption><span>The repeatPassword directive</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">directives</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s2">&quot;repeatPassword&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">require</span><span class="o">:</span> <span class="s2">&quot;ngModel&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">link</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">ctrl</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">otherInput</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">inheritedData</span><span class="p">(</span><span class="s2">&quot;$formController&quot;</span><span class="p">)[</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">repeatPassword</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$parsers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">otherInput</span><span class="p">.</span><span class="nx">$viewValue</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>                    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">otherInput</span><span class="p">.</span><span class="nx">$parsers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$viewValue</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Using repeatPassword directive</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">id=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;repeat password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;user.repeatPassword&quot;</span> <span class="na">repeat-password=</span><span class="s">&quot;password&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first I was trying to attach $parser function to just the element the directive was attached to. But this didn&rsquo;t work, because when I was comparing to the value stored in controller the results not always were correct. The reason for this is that invalid values are not passed to controller, and so when one value was invalid, it wasn&rsquo;t present in controller, and directive failed. As you can see, the trick is to attach $parsers to each control that requires syncing. This took me some time to figure out, but for now it works quite nice.</p>

<h3>Summary</h3>

<p>Angular directives are quite nice. They can be used to create reusable components and in this case, I created something that was automatically usable in three places, without the need to writing any controller code. Moreover, this directive is not only for passwords &ndash; rename that to stringsMatch and you get a nice directive that checks if you string values are in sync. Neat!</p>

<p>This change has been introduced in <a href="http://bootstrap.softwaremill.com/#/">Bootstrap</a> in <a href="https://github.com/softwaremill/bootstrap/commit/515d289ddea2159b8c3eaa956cdfb658898b5358">this commit</a>.</p>
</div>
		<div style="display:table-cell;width:160px;vertical-align:top;">
			<script type="text/javascript"><!--
google_ad_client = "ca-pub-1415710675472129";
/* post right side */
google_ad_slot = "4791270460";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
		</div>
	
	

</article>
<div style="text-align:center;"><script type="text/javascript"><!--
google_ad_client = "ca-pub-1415710675472129";
/* banner */
google_ad_slot = "3314537266";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Piotr Buda -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'piotrbuda';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://piotrbuda.eu/2013/02/angularjs-directive-for-password-matching.html';
        var disqus_url = 'http://piotrbuda.eu/2013/02/angularjs-directive-for-password-matching.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-16458721-6']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
