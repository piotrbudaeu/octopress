
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Software Development Ramblings</title>
  <meta name="author" content="Piotr Buda">

  
  <meta name="description" content="ScalaWebSocket On April 21st I pushed the ScalaWebSocket library to GitHub. But what is it? As the name suggests, it&rsquo;s WebSockets for Scala. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://piotrbudaeu.github.io/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/SoftwareDevelopmentRamblings" rel="alternate" title="Software Development Ramblings" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16458721-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Software Development Ramblings</a></h1>
  
    <h2>Java, Scala and Android; Architecture and Design</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/SoftwareDevelopmentRamblings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:piotrbudaeu.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/04/scalawebsocket.html">ScalaWebSocket</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-24T16:45:00+02:00" pubdate data-updated="true">Apr 24<span>th</span>, 2013</time>
        
         | <a href="/2013/04/scalawebsocket.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>ScalaWebSocket</h3>

<p>On April 21st I pushed the <a href="https://github.com/pbuda/scalawebsocket">ScalaWebSocket</a> library to GitHub. But what is it? As the name suggests, it&rsquo;s WebSockets for Scala.</p>

<p>There are already a few implementations of WebSocket for Java, there is also the Scala project called <a href="https://github.com/jfarcand/WCS">wCS</a> but all of them support Javaish style of passing the anonymous implementations of some kind of Listener interface. I didn&rsquo;t want that as I prefer the functional style of handlers.</p>

<p>ScalaWebSocket is a thin wrapper around <a href="https://github.com/AsyncHttpClient/async-http-client">async-http-client</a> and it exposes a more Scala-like vocabulary to interact with WebSockets.</p>

<h3>Installation</h3>

<p>To start using it in your project</p>

<figure class='code'><figcaption><span>Dependency in SBT </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>libraryDependncies += "eu.piotrbuda" %% "scalawebsocket" % "0.1.0"</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Dependency in Maven </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;dependency>
</span><span class='line'>  &lt;groupId>eu.piotrbuda&lt;/groupId>
</span><span class='line'>  &lt;artifactId>scalawebsocket_2.10&lt;/artifactId>
</span><span class='line'>  &lt;version>0.1.0&lt;/version>
</span><span class='line'>&lt;/dependency></span></code></pre></td></tr></table></div></figure>


<h3>Examples</h3>

<p>Usage of this library is very simple.</p>

<figure class='code'><figcaption><span>Open a WebSocket connection </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">WebSocket</span><span class="o">().</span><span class="n">open</span><span class="o">(</span><span class="s">&quot;ws://echo.websocket.org/&quot;</span><span class="o">).</span><span class="n">sendText</span><span class="o">(</span><span class="s">&quot;text&quot;</span><span class="o">).</span><span class="n">close</span><span class="o">().</span><span class="n">shutdown</span><span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Listen for text messages </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">WebSocket</span><span class="o">().</span><span class="n">open</span><span class="o">(</span><span class="s">&quot;ws://echo.websocket.org/&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">.</span><span class="n">onTextMessage</span><span class="o">(</span><span class="n">msg</span> <span class="k">=&gt;</span> <span class="n">doSomethingWithMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Add several listeners </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="nc">WebSocket</span><span class="o">().</span><span class="n">open</span><span class="o">(</span><span class="s">&quot;ws://echo.websocket.org/&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">.</span><span class="n">onTextMessage</span><span class="o">(</span><span class="n">msg</span> <span class="k">=&gt;</span> <span class="n">doSomethingWithMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
</span><span class='line'><span class="o">.</span><span class="n">onBinaryMessage</span><span class="o">(</span><span class="n">msg</span> <span class="k">=&gt;</span> <span class="n">doSomethingWithBinaryMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Future</h3>

<p>I need this library to talk to SocketIO servers, so in version 0.2.0 I will implement some basic support for SocketIO.
 For now, please use it and report any issues you have. My goal for this library is to make WebSocket natural in Scala.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/02/trying-to-deploy-scala-app-on-openshift.html">Trying to Deploy Scala App on OpenShift</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-26T10:35:00+01:00" pubdate data-updated="true">Feb 26<span>th</span>, 2013</time>
        
         | <a href="/2013/02/trying-to-deploy-scala-app-on-openshift.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>The beggining</h3>

<p>This is a simple log of what I have done during past few days trying to deploy a simple app to <a href="https://openshift.redhat.com/app/">OpenShift</a>. I thought it would be quite easy but apparently this is beyond my knowledge. My application is a simple Hello World app. The only real requirement is that I wanted this app to compile with Scala 2.10.</p>

<h3>Setup</h3>

<p>I won&rsquo;t discuss how to set up the application on <a href="https://openshift.redhat.com/app/">OpenShift</a> (unless it is really needed). The only thing worth mentioning is that you will need a Do-It-Yourself type.</p>

<h3>SBT</h3>

<p>There is no <a href="http://www.scala-sbt.org/">SBT</a> on <a href="https://openshift.redhat.com/app/">OpenShift</a>. That&rsquo;s right, you have to get it yourself. <a href="https://openshift.redhat.com/app/">OpenShift</a> however provides a nice way of storing things with its data directory (available at $OPENSHIFT_DATA_DIR) and it&rsquo;s action hooks are the way to go in this case. After some trial and error this is the script I came up with.</p>

<figure class='code'><figcaption><span>pre_build script</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd $OPENSHIFT_DATA_DIR
</span><span class='line'>
</span><span class='line'>if [[ -d sbt ]]; then
</span><span class='line'>  echo "SBT installed"
</span><span class='line'>else
</span><span class='line'>  curl -o sbt.tgz http://scalasbt.artifactoryonline.com/scalasbt/sbt-native-packages/org/scala-sbt/sbt/0.12.2/sbt.tgz
</span><span class='line'>  tar zxvf sbt.tgz sbt
</span><span class='line'>  rm sbt.tgz
</span><span class='line'>fi</span></code></pre></td></tr></table></div></figure>


<p>This script basically downloads SBT from its site but only if SBT folder is not present in the data directory. Then the downloaded tgz archive gets unpacked and SBT is ready to be used.</p>

<h3>Building</h3>

<p>Now this is the part I spent most time with and unfortunately I can&rsquo;t make it fully work :( There were several issues with building using <a href="http://www.scala-sbt.org/">SBT</a>, but after some time it almost worked. Here&rsquo;s the build script I developed that semi-works.</p>

<figure class='code'><figcaption><span>build script</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SBT_PATH=$OPENSHIFT_DATA_DIR/sbt
</span><span class='line'>SBT_DIR=$OPENSHIFT_DATA_DIR/.sbt
</span><span class='line'>IVY_DIR=$OPENSHIFT_DATA_DIR/.ivy
</span><span class='line'>
</span><span class='line'>cd $OPENSHIFT_REPO_DIR
</span><span class='line'>
</span><span class='line'>$SBT_PATH/bin/sbt -sbt-dir $SBT_DIR -ivy $IVY_DIR start-script</span></code></pre></td></tr></table></div></figure>


<p>This took a while to figure out. Let&rsquo;s go line by line to see what everything is needed for. Lines 1, 2 and 3 define three variables that are required to run <a href="http://www.scala-sbt.org/">SBT</a> (they could have been moved to pre_build script to keep everything SBT related in one place).
* Line 1 simply defines the path to <a href="http://www.scala-sbt.org/">SBT</a> directory.
* Line 2 is a variable with path to folder <a href="http://www.scala-sbt.org/">SBT</a> uses to store its data. On <a href="https://openshift.redhat.com/app/">OpenShift</a> you don&rsquo;t have permission to write to your home directory, hence a need for custom dir.
* Line 3 is like line 2 except for Ivy cache.
* Line 5 then switches to the repository directory. This is the place where your sources reside and this is mostly the place where you should start your build at.
* Line 7 is a simple invocation of the SBT with the predefined settings. I&rsquo;m generating a start script here (using xsbt-start-script-plugin) and that&rsquo;s why I only include this goal.</p>

<p>This somewhat works. Considering the requirements we now have a project that uses Scala 2.10. But there are now two things to consider.</p>

<p>At first in pre_build I downloaded SBT 0.12.2 and in project build.settings I had SBT setup to 0.12.1. This triggered a compilation of &lsquo;compiler-interface&rsquo;.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>remote: [info] Compiling 1 Scala source to /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes...
</span><span class='line'>remote: [info] 'compiler-interface' not yet compiled for Scala 2.10.0. Compiling...</span></code></pre></td></tr></table></div></figure>


<p>But this failed. Compilation wouldn&rsquo;t finish and the process was killed. Small fix in build.properties and upping the actual <a href="http://www.scala-sbt.org/">SBT</a> version to 0.12.2 fixed this &ndash; no more recompilation of &lsquo;compiler-interface&rsquo;.</p>

<p>When you push your project to <a href="https://openshift.redhat.com/app/">OpenShift</a> now, it downloads SBT, unpacks it and tries to build your project. And it fails with the same error as above.</p>

<figure class='code'><figcaption><span>Build fails after git push</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>remote: restart_on_add=false
</span><span class='line'>remote: stop
</span><span class='line'>remote: Done
</span><span class='line'>remote: restart_on_add=false
</span><span class='line'>remote: Running .openshift/action_hooks/pre_build
</span><span class='line'>remote: pre_build
</span><span class='line'>remote: SBT installed
</span><span class='line'>remote: Running .openshift/action_hooks/build
</span><span class='line'>remote: build
</span><span class='line'>remote: /var/lib/openshift/512617424382ec272a0000b1/git/yatstaging2.git
</span><span class='line'>remote: /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo
</span><span class='line'>remote: [info] Loading project definition from /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/project
</span><span class='line'>remote: [info] Updating {file:/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/project/}default-2353b7...
</span><span class='line'>        [info] Resolving org.scala-sbt#precompiled-2_10_0;0.12.2 ...
</span><span class='line'>remote: [info] Done updating.
</span><span class='line'>remote: [info] Set current project to YAT Server (in build file:/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/)
</span><span class='line'>remote: [info] Updating {file:/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/}default-e6271e...
</span><span class='line'>remote: [info] Resolving org.scala-lang#scala-library;2.10.0 ...
</span><span class='line'>remote: [info] Done updating.
</span><span class='line'>remote: [debug]
</span><span class='line'>remote: [debug] Initial source changes:
</span><span class='line'>remote: [debug]   removed:Set()
</span><span class='line'>remote: [debug]   added: Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>remote: [debug]   modified: Set()
</span><span class='line'>remote: [debug] Removed products: Set()
</span><span class='line'>remote: [debug] Modified external sources: Set()
</span><span class='line'>remote: [debug] Modified binary dependencies: Set()
</span><span class='line'>remote: [debug] Initial directly invalidated sources: Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>remote: [debug]
</span><span class='line'>remote: [debug] Sources indirectly invalidated by:
</span><span class='line'>remote: [debug]   product: Set()
</span><span class='line'>remote: [debug]   binary dep: Set()
</span><span class='line'>remote: [debug]   external source: Set()
</span><span class='line'>remote: [debug] Initially invalidated: Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>remote: [debug] Recompiling all 1 sources: invalidated sources (1) exceeded 50.0% of all sources
</span><span class='line'>remote: [info] Compiling 1 Scala source to /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes...
</span><span class='line'>remote: [debug] Running cached compiler 18d45f0, interfacing (CompilerInterface) with Scala compiler version 2.10.0
</span><span class='line'>remote: [debug] Calling Scala compiler with arguments  (CompilerInterface):
</span><span class='line'>remote: [debug]   -d
</span><span class='line'>remote: [debug]   /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes
</span><span class='line'>remote: [debug]   -bootclasspath
</span><span class='line'>remote: [debug]   /usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/resources.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/rt.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/jsse.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/jce.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/charsets.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/netx.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/plugin.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/rhino.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/jfr.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/classes:/var/lib/openshift/512617424382ec272a0000b1/app-root/data/.sbt/boot/scala-2.10.0/lib/scala-library.jar
</span><span class='line'>remote: [debug]   -classpath
</span><span class='line'>remote: [debug]   /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes
</span><span class='line'>remote: /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/.openshift/action_hooks/build: line 21:  7042 Killed            $SBT_PATH/bin/sbt -sbt-dir $SBT_DIR -ivy $IVY_DIR start-script
</span><span class='line'>remote: Running .openshift/action_hooks/deploy
</span><span class='line'>remote: deploy
</span><span class='line'>remote: hot_deploy_added=false
</span><span class='line'>remote: start
</span><span class='line'>remote: Done
</span><span class='line'>remote: start: missing job name
</span><span class='line'>remote: Try `start --help' for more information.
</span><span class='line'>remote: Running .openshift/action_hooks/post_deploy
</span><span class='line'>remote: post_deploy</span></code></pre></td></tr></table></div></figure>


<p>The process is being killed anyway. This was driving me crazy, because no matter what I did the build always crashed. Then I tried SSH and run the script manually and… bam! It worked.</p>

<figure class='code'><figcaption><span>Build successful when run manually from SSH session</span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>build
</span><span class='line'>/var/lib/openshift/512617424382ec272a0000b1
</span><span class='line'>/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo
</span><span class='line'>[info] Loading project definition from /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/project
</span><span class='line'>[info] Set current project to YAT Server (in build file:/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/)
</span><span class='line'>[debug]
</span><span class='line'>[debug] Initial source changes:
</span><span class='line'>[debug]   removed:Set()
</span><span class='line'>[debug]   added: Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>[debug]   modified: Set()
</span><span class='line'>[debug] Removed products: Set()
</span><span class='line'>[debug] Modified external sources: Set()
</span><span class='line'>[debug] Modified binary dependencies: Set()
</span><span class='line'>[debug] Initial directly invalidated sources: Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>[debug]
</span><span class='line'>[debug] Sources indirectly invalidated by:
</span><span class='line'>[debug]   product: Set()
</span><span class='line'>[debug]   binary dep: Set()
</span><span class='line'>[debug]   external source: Set()
</span><span class='line'>[debug] Initially invalidated: Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>[debug] Recompiling all 1 sources: invalidated sources (1) exceeded 50.0% of all sources
</span><span class='line'>[info] Compiling 1 Scala source to /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes...
</span><span class='line'>[debug] Running cached compiler 12a6774, interfacing (CompilerInterface) with Scala compiler version 2.10.0
</span><span class='line'>[debug] Calling Scala compiler with arguments  (CompilerInterface):
</span><span class='line'>[debug]   -d
</span><span class='line'>[debug]   /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes
</span><span class='line'>[debug]   -bootclasspath
</span><span class='line'>[debug]   /usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/resources.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/rt.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/jsse.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/jce.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/charsets.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/netx.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/plugin.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/rhino.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/lib/jfr.jar:/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.9/jre/classes:/var/lib/openshift/512617424382ec272a0000b1/app-root/data/.sbt/boot/scala-2.10.0/lib/scala-library.jar
</span><span class='line'>[debug]   -classpath
</span><span class='line'>[debug]   /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/scala-2.10/classes
</span><span class='line'>[debug] Scala compilation took 34.206682197 s
</span><span class='line'>[debug] Step 2 changed sources and immdediate dependencies:
</span><span class='line'>[debug]   Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>[debug] Non-trivial strongly connected components:
</span><span class='line'>[debug]
</span><span class='line'>[debug] Step 2 invalidated sources:
</span><span class='line'>[debug]   Set(/var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/src/main/scala/pl/apptile/yat/YAT.scala)
</span><span class='line'>[info] Wrote start script for mainClass := Some(pl.apptile.yat.YAT) to /var/lib/openshift/512617424382ec272a0000b1/app-root/runtime/repo/target/start</span></code></pre></td></tr></table></div></figure>


<p>This is quite puzzling and I can&rsquo;t figure out why automatic build doesn&rsquo;t work. What&rsquo;s worth mentioning though is that it does work when you change Scala to 2.9.2. But it&rsquo;s against requirements and hence I stopped at this point, unable to continue.</p>

<h3>Summary</h3>

<p>While I was really happy that most of the things were quite easy to start with, inability to compile the sources makes it a no-no for further work, like actually starting a spray-can server. My application was a Hello World app and if this can&rsquo;t compile… Sorry <a href="https://openshift.redhat.com/app/">OpenShift</a>, for now I&rsquo;m switching to <a href="http://www.cloudfoundry.com/">CloudFoundry</a> to see how it fares.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/02/angularjs-directive-for-password-matching.html">Angular Directive for Password Matching</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-12T11:30:00+01:00" pubdate data-updated="true">Feb 12<span>th</span>, 2013</time>
        
         | <a href="/2013/02/angularjs-directive-for-password-matching.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently at <a href="http://bootstrap.softwaremill.com/#/">Bootstrap</a> I was working on the profile page part. I had to introduce a simple validation of passwords &ndash; when you type in your password, you often have to repeat it. This was implemented in a few places already, however it wasn&rsquo;t correct &ndash; changing the original password did not trigger validation.</p>

<p>To see how this works, just go to the <a href="http://bootstrap.softwaremill.com">Bootstrap page</a> and play with the registration form&rsquo;s &ldquo;password&rdquo; and &ldquo;repeat password&rdquo; inputs. All code snippets are taken from <a href="http://bootstrap.softwaremill.com/#/">Bootstrap</a>.</p>

<h3>Requirements</h3>

<p>We have two input fields and we just need to validate whether values in them are synchronized. Values entered in both these fields need to be the same, if they&rsquo;re not, then display error message next to the second input field that the contents are invalid.</p>

<h3>Simple approach</h3>

<p>When I started, there was something implemented already. It was a simple solution that based on the <a href="http://docs.angularjs.org/api/ng.directive:ngChange">ng-change</a> directive. This directive was attached to the repeated field and every time the value changed, method checkPassword() in RegisterController was called.</p>

<figure class='code'><figcaption><span>How checkPassword() was used</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">id=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;repeat password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;user.repeatPassword&quot;</span> <span class="na">ng-change=</span><span class="s">&quot;checkPassword()&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Validation in checkPassword method</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$scope</span><span class="p">.</span><span class="nx">checkPassword</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">registerForm</span><span class="p">.</span><span class="nx">repeatPassword</span><span class="p">.</span><span class="nx">$error</span><span class="p">.</span><span class="nx">dontMatch</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span> <span class="o">!==</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">repeatPassword</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The dontMatch error flag was then used to display error message.</p>

<figure class='code'><figcaption><span>Using dontMatch flag to display error</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;text-error&quot;</span> <span class="na">ng-show=</span><span class="s">&quot;registerForm.repeatPassword.$dirty &amp;&amp; registerForm.repeatPassword.$error.dontMatch&quot;</span><span class="nt">&gt;</span>Passwords don&#39;t match!<span class="nt">&lt;/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This isn&rsquo;t the best solution. First of all, this only checked equity upon changing the repeated field, not the original password field. To make this work it would be required in both original and repeated fields. This also wasn&rsquo;t reusable &ndash; to use it in another place, checkPassword method had to be actually copied.</p>

<h3>Angular directive to the rescue</h3>

<p>Directives in AngularJS are used to create reusable components so I thought about how to use them to solve the validation problem. It was rather easy and straightforward.</p>

<figure class='code'><figcaption><span>The repeatPassword directive</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">directives</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s2">&quot;repeatPassword&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">require</span><span class="o">:</span> <span class="s2">&quot;ngModel&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">link</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">ctrl</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">otherInput</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">inheritedData</span><span class="p">(</span><span class="s2">&quot;$formController&quot;</span><span class="p">)[</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">repeatPassword</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$parsers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">otherInput</span><span class="p">.</span><span class="nx">$viewValue</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>                    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">otherInput</span><span class="p">.</span><span class="nx">$parsers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$setValidity</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">ctrl</span><span class="p">.</span><span class="nx">$viewValue</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Using repeatPassword directive</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">id=</span><span class="s">&quot;repeatPassword&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;repeat password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;user.repeatPassword&quot;</span> <span class="na">repeat-password=</span><span class="s">&quot;password&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first I was trying to attach $parser function to just the element the directive was attached to. But this didn&rsquo;t work, because when I was comparing to the value stored in controller the results not always were correct. The reason for this is that invalid values are not passed to controller, and so when one value was invalid, it wasn&rsquo;t present in controller, and directive failed. As you can see, the trick is to attach $parsers to each control that requires syncing. This took me some time to figure out, but for now it works quite nice.</p>

<h3>Summary</h3>

<p>Angular directives are quite nice. They can be used to create reusable components and in this case, I created something that was automatically usable in three places, without the need to writing any controller code. Moreover, this directive is not only for passwords &ndash; rename that to stringsMatch and you get a nice directive that checks if you string values are in sync. Neat!</p>

<p>This change has been introduced in <a href="http://bootstrap.softwaremill.com/#/">Bootstrap</a> in <a href="https://github.com/softwaremill/bootstrap/commit/515d289ddea2159b8c3eaa956cdfb658898b5358">this commit</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/02/my-first-month-at-softwaremill.html">My First Month at SoftwareMill</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-11T08:06:00+01:00" pubdate data-updated="true">Feb 11<span>th</span>, 2013</time>
        
         | <a href="/2013/02/my-first-month-at-softwaremill.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The year 2012 was a year of change to me. First I was moved to a new team in CGM Poland. Things were nice at first, but after a while I lost all my motivation to work. It was time to change the organization and so I applied to a company called <a href="http://www.softwaremill.com">SoftwareMill</a>.
Why them? Trully a coincidence. I was browsing some stuff on LinkedIn and I stumbled upon their job posting and I got intrigued by the fact that they mentioned possibility to work from home. As it turned out, the whole team is distributed! But then I took a closer look at the company and noticed that on SoftwareMill website there&rsquo;s a <a href="http://softwaremill.com/why-softwaremill/our-team">section about developers</a>. Browsing short descriptions of those who worked there I thought that it was a very good company to work at. So I applied in August. It took a longer while to finish the recruitment process (I wasn&rsquo;t accepted at first), but I finally started work at SoftwareMill on 2nd January 2013.</p>

<p>Now a month has passed and I have to say that I&rsquo;m very happy I was given the chance. Not only have I met some brilliant people but it was also a great cultural change for me: from big company, corporation, to a smaller entity with more focus on single developers.</p>

<p>This experience is quite pleasant. Frequent code reviews is something I often missed in my previous jobs but here I have them almost every push to Git repo. That&rsquo;s reassuring, as any mistake I make may be quickly recognized by someone else, but I think I don&rsquo;t have to stress out how important code reviews are :)</p>

<p>The next thing I&rsquo;d like to mention is the Scrum/Chrum meetings. Every team has a Scrum sometime before 10:00. It&rsquo;s your normal Scrum meeting where you answer the three questions. Then is the Chrum meeting. Since the team is distributed, we don&rsquo;t see each other normally, so at 10:00 we have a video meeting where we answer additional, fourth question. This question can be anything &ndash; from what was your yesterday&rsquo;s dinner to how does your surrounding look like at the moment. This is really quite fun meeting and most importantly it&rsquo;s self organizing. There is no specific order at which people speak out but we usually end the meeting around 10:20. When the official meeting is over we are free to discuss about anything.</p>

<p>Working from home was something I always wanted to try and now I have the chance. I was affraid though that some responsibilities might take over my work (like cooking dinner, for example) but fortunately that&rsquo;s not the case. I think I adapted pretty quickly to working from home, <a href="http://dilbert.com/strips/comic/2013-02-10/">despite many distractions</a>. There are occasional problems, like having a sick kid at home, but other than that, distractions can be avoided. It&rsquo;s also worth noting that remote work does not equal to working from home, which I hope to prove sometime soon :)</p>

<p>For now I&rsquo;m developing this open source project called <a href="https://github.com/softwaremill/bootstrap">SML Bootstrap</a> and while it&rsquo;s nothing too big, it helps me to familiarize with how things work at SoftwareMill. I also encourage you to check this project out &ndash; it&rsquo;s quite simple, but can be useful if you start your project with Scala and AngularJS.</p>

<p>As a last note I&rsquo;ll just mention that I was given this Macbook Pro to work with ;) While I never agreed with how Apple works, but I have to admit that the quality of build of this machine is just superb.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/12/scala-and-android-asynctask-implementation-problem.html">Scala and Android: AsyncTask Implementation Problem</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-12T13:06:00+01:00" pubdate data-updated="true">Dec 12<span>th</span>, 2012</time>
        
         | <a href="/2012/12/scala-and-android-asynctask-implementation-problem.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I recently started some really simple Scala development for Android. However because I&rsquo;m a very lucky person, I stumbled upon my first problem the very first moment I tried doing something nice.</p>

<p>There is a neat way for doing things in Android with AsyncTasks &ndash; this cool utility abstracts away the need for creation and management of threads for invoking stuff that would block UI thread. For more info just go to AsyncTask documentation.</p>

<p>So I tried doing something with this cool AsyncTask and here&rsquo;s the class definition:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nf">ObtainRequestTokenTask</span><span class="o">()</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">[</span><span class="n">String</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">override</span> <span class="kd">protected</span> <span class="n">def</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="nl">p1:</span> <span class="n">String</span><span class="o">*):</span> <span class="n">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The major problem here is that this thing compiles. Running this on Android emulator I got an exception suggesting that doInBackground is not implemented (it&rsquo;s abstract in AsyncTask)&hellip; So where&rsquo;s the problem?</p>

<p>Googling about this I found <a href="https://issues.scala-lang.org/browse/SI-1459">this bug</a>. I won&rsquo;t go into detail, however to make this code work you have to actually change the signature of doInBackground. Instead of String input, you need AnyRef and just cast params to the desired class.</p>

<p>For me this now looks something like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nf">ObtainRequestTokenTask</span><span class="o">()</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">[</span><span class="n">AnyRef</span><span class="o">,</span> <span class="n">Void</span><span class="o">,</span> <span class="n">String</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">override</span> <span class="kd">protected</span> <span class="n">def</span> <span class="nf">doInBackground</span><span class="o">(</span><span class="nl">p1:</span> <span class="n">AnyRef</span><span class="o">*):</span> <span class="n">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'><span class="n">p1</span><span class="o">.</span><span class="na">head</span><span class="o">.</span><span class="na">asInstanceOf</span><span class="o">[</span><span class="n">String</span><span class="o">]</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/warsjawa-2012.html">Warsjawa 2012</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-29T13:02:00+01:00" pubdate data-updated="true">Oct 29<span>th</span>, 2012</time>
        
         | <a href="/2012/10/warsjawa-2012.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I didn&rsquo;t attent any conference for the past 18 months. Last time I was on one was when I was sent to eye-opening meeting with Greg Young. Recently a friend of mine suggested that we should go to <a href="http://warszawa.jug.pl/warsjawa-2012">Warsjawa 2012</a> conference as it&rsquo;s free and relatively close to Lublin.</p>

<p>We decided to sign up for a workshop called &lsquo;One day with a difficult client&rsquo; that was lead by guys from <a href="http://softwaremill.com/">SoftwareMill</a>. The idea of the workshop was to show attendees some common problems people face when working with their clients. Even though I don&rsquo;t work directly with our client every day I read a few things here and there how they can be PITA and I had some expectations regarding this workshop. It turned out great and here&rsquo;s how it went.</p>

<p>The whole workshop began with a short, but fun, game which helped every attendee remember other&rsquo;s names. This game is very simple: just say your name and make up some kind of symbol (V sign, finger on your mouth, anything) and the person after you has to repeat EVERY name and EVERY symbol before. There were 13 attendees and 3 leaders so after 16 rounds we pretty much knew every name. Very fun way of introducing a group of people to each other, and very efficient at that.</p>

<p>After that we were split into three groups and each group was given a contract to build a space capsule. We were presented with some stuff that we could use (scissors, paper, glue, boxes, foil &ndash; you get the picture) and we had some time to think about the contract. The whole game was to take around 1,5 hours and it was split into a few 15-20 minute sprints. After each sprint our client would come and look at what we&rsquo;ve done and answer questions.</p>

<p>When the time run out we were taken to the launch site &ndash; the capsule had to actually fly! The clients were mostly happy and we mostly delivered what they wanted. Or did we? That was the whole point of the workshop. We started out with a contract for a space capsule and ended up with a prototype model that instead of flying out to space was to fly just three meters straight from the launcher, which wasn&rsquo;t a rocket booster but a simple slingshot.</p>

<p>At the end, we were doing retrospectives in teams and shared our experiences with others. Some teams had problems other didn&rsquo;t and guys from SoftwareMill told us what we did good and where our attention should be next time. I can&rsquo;t tell for other teams, but our team didn&rsquo;t have most of the problems, and we also did the best looking capsule! Unfortunately we did one thing wrong &ndash; we emphasized one aspect of the capsule without much regard to another which resulted in the best looking and most secure capsule that&hellip; didn&rsquo;t fly.</p>

<p>There were a few things I didn&rsquo;t like though. The difficult client didn&rsquo;t appear that difficult after all. I expected the client to be a little more aggresive, inconsistent (the &lsquo;client&rsquo; had three representatives and on each meeting another representative was present, and mostly agreed with his/her colegues) and impatient. But apparently some previous groups had problems already and this workshop was meant to be fun and not hardcore :) I can live with that.</p>

<p>Another &lsquo;thing&rsquo; was that shortly after the workshop was over, everyone was gone. We couldn&rsquo;t talk more about what happened and share more experiences, not only regarding workshops. I&rsquo;d definately fix that next time because for me this was the worst thing to happen.</p>

<p>Overall, it was one of the best days lately. Lots of laughter, lots of good experience and lots of great people to work with. I think I will attend Warsjawa 2013 :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/scala-case-classes-and-annotations-part-2.html">Scala Case Classes and Annotations, Part 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-28T23:00:00+01:00" pubdate data-updated="true">Oct 28<span>th</span>, 2012</time>
        
         | <a href="/2012/10/scala-case-classes-and-annotations-part-2.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Before proceeding please remember that I&rsquo;m learning Scala and what follows is the result of lack of proper knowledge :)</p>

<p>In the previous article I wrote how to specify where annotations should be applied. But if you remember an example class I ported from Java to Scala there was one thing left to do and that was using constants in annotations.</p>

<p>In Java you can easily do</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER_ID</span> <span class="o">=</span> <span class="s">&quot;userId&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Field</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">)</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">long</span> <span class="n">userId</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>but in Scala this doesn&rsquo;t work.</p>

<p>First of all I tried adding constant in a class like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">USER_ID</span><span class="o">)</span> <span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>                            <span class="o">@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">STATUS_ID</span><span class="o">)</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">val</span> <span class="nc">USER_ID</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;userId&quot;</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">val</span> <span class="nc">STATUS_ID</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;statusId&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>but in Scala USER_ID and STATUS_ID are not resolved. Since normally an object is used for defining static content I then tried using a companion object to store those constants:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">ScanningBookmark</span><span class="o">.</span><span class="nc">USER_ID</span><span class="o">)</span> <span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>                            <span class="o">@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">ScanningBookmark</span><span class="o">.</span><span class="nc">STATUS_ID</span><span class="o">)</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
</span><span class='line'><span class="k">object</span> <span class="nc">ScanningBookmark</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">val</span> <span class="nc">USER_ID</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;userId&quot;</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">val</span> <span class="nc">STATUS_ID</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;statusId&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>but this also didn&rsquo;t work as it gave the following error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>error: annotation argument needs to be a constant; found: ScanningBookmark.USER_ID
</span><span class='line'>case class ScanningBookmark(@(Field@field)(ScanningBookmark.USER_ID) userId: Long,</span></code></pre></td></tr></table></div></figure>


<p>At this point I gave up. I tried looking for answer at Google but didn&rsquo;t find it &ndash; or as it occured later &ndash; just missed it.</p>

<p>The problem here is that in Scala a constant doesn&rsquo;t have type in definition. The last thing necessary to make those constants work was removing the String type from definitions:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">ScanningBookmark</span><span class="o">.</span><span class="nc">USER_ID</span><span class="o">)</span> <span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>                            <span class="o">@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">ScanningBookmark</span><span class="o">.</span><span class="nc">STATUS_ID</span><span class="o">)</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
</span><span class='line'><span class="k">object</span> <span class="nc">ScanningBookmark</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">val</span> <span class="nc">USER_ID</span> <span class="k">=</span> <span class="s">&quot;userId&quot;</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">val</span> <span class="nc">STATUS_ID</span> <span class="k">=</span> <span class="s">&quot;statusId&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now it compiles and works as expected.</p>

<p>This is the end of my short experience with Scala and annotations.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/scala-case-classes-and-annotations-part-1.html">Scala Case Classes and Annotations, Part 1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-28T19:23:00+01:00" pubdate data-updated="true">Oct 28<span>th</span>, 2012</time>
        
         | <a href="/2012/10/scala-case-classes-and-annotations-part-1.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently in Twittory I moved from Java to Scala. Well, to be honest I just switched from Java to Scala syntax and will move on to adapt to functional programming principles.</p>

<p>There was one glitch during the process. I am using Spring Data for MongoDb and to ease up a few queries I used statics to define field names of objects I store.</p>

<p>Here&rsquo;s an example: very simple class that I use to store tweet scanning bookmarks:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScanningBookmark</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER_ID</span> <span class="o">=</span> <span class="s">&quot;userId&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">STATUS_ID</span> <span class="o">=</span> <span class="s">&quot;statusId&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">ScanningBookmark</span><span class="o">(</span><span class="kt">long</span> <span class="n">userId</span><span class="o">,</span> <span class="kt">long</span> <span class="n">statusId</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">statusId</span> <span class="o">=</span> <span class="n">statusId</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Field</span><span class="o">(</span><span class="n">USER_ID</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">long</span> <span class="n">userId</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Field</span><span class="o">(</span><span class="n">STATUS_ID</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">long</span> <span class="n">statusId</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getStatusId</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">statusId</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Storing this thing with Spring Data. The static fields defining field names are here so that somewhere else I can define a query using those fields. The @Field annotations allow customization of field names in collections and while here they are the same as actual field names, they could be set differently.</p>

<p>Now when I was rewriting this to Scala, it&rsquo;s quite obvious I ended up with a case class.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>But the problem with case class is that adding @Field annotations doesn&rsquo;t work anymore. This is because writing like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(</span><span class="nd">@Field</span><span class="o">(</span><span class="s">&quot;userId&quot;</span><span class="o">)</span> <span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>                            <span class="nd">@Field</span><span class="o">(</span><span class="s">&quot;statusId&quot;</span><span class="o">)</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>places the @Field annotation on constructor arguments, fields and Scala accessors which probably makes Spring Data scanner fail. The result is that these fields are no longer customizable and I wanted to somehow remedy that.</p>

<p>Playing with @BeanProperty annotation didn&rsquo;t solve the problem because apparently the @Field annotation is then also placed on generated accessors. But solution to this problem is actually quite easy. In Scala there are target meta-annotations that can be put on the annotation type when instantiating the annotation. There are six of those: @beanGetter, @beanSetter, @field, @getter, @setter, @param. Consult the <a href="http://www.scala-lang.org/api/current/scala/annotation/target/package.html">target package</a> for more info.</p>

<p>The solution? It&rsquo;s very simple:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="s">&quot;userId2&quot;</span><span class="o">)</span> <span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>                            <span class="o">@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="s">&quot;statusId2&quot;</span><span class="o">)</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&rsquo;s it! But there&rsquo;s one last thing to make it behave like Java version. In Java I used statics to define field values (so that there&rsquo;s no problem when some name changes). So I want something like this:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">ScanningBookmark</span><span class="o">(@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">USER_ID</span><span class="o">)</span> <span class="n">userId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>                            <span class="o">@(</span><span class="nc">Field</span><span class="nd">@field</span><span class="o">)(</span><span class="nc">STATUS_ID</span><span class="o">)</span> <span class="n">statusId</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">final</span> <span class="k">val</span> <span class="nc">USER_ID</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;userId2&quot;</span>
</span><span class='line'>  <span class="k">final</span> <span class="k">val</span> <span class="nc">STATUS_ID</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;statusId2&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But this is not how things work in Scala and it took a while to learn that :) But this is for another short post.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/09/function-programming-principles-in-scala-course-week-one.html">Function Programming Principles in Scala Course - Week One</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-25T16:02:00+02:00" pubdate data-updated="true">Sep 25<span>th</span>, 2012</time>
        
         | <a href="/2012/09/function-programming-principles-in-scala-course-week-one.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So the course started a week ago and I&rsquo;d like to share my opinion after the first week.</p>

<p>First of all I got this feeling that most people attending the course thought that it&rsquo;ll be a Scala course. While Scala is used to demonstrate functional programming principles it is not a Scala course. You have to know Scala on your own, however for now Martin Odersky does explain it&rsquo;s syntax. If you&rsquo;re into learning Scala only, this is not a course for you IMO.</p>

<p>Lectures are recorded with good quality and Martin&rsquo;s English is very good, he also speaks slowly. This is OK for people who have problems with understanding English and for those who don&rsquo;t, you can increase video speed to 1.25x or even 1.5x and it&rsquo;s still quite easy to understand what he&rsquo;s saying.</p>

<p>Since it&rsquo;s my first Coursera course, I was surprised with the first quiz during a lecture :) but these are nice little stops for you to think. Sometimes you have to check a proper answer and sometimes you are only asked to do something on your own.</p>

<p>As for assignments, they are pretty clear. You have to do a thing or two and submit your solutions. Altough there are tests written for you already, the very first thing that I did for the first assignment was adding a few tests for corner cases. Later on things were smoothly as the assignments were not that hard.</p>

<p>I&rsquo;ve had a few problems with the countChange function but mainly because I made some wrong assumptions (thanks go to <a href="https://twitter.com/marcinderylo">@marcinderylo</a> for pointing that out to me). I didn&rsquo;t use Eclipse or Intellij Idea for the first assignment &ndash; I used vim and just set tests to run continously in sbt. For the next week I plan to use Intellij, however the course is setup using Eclipse (it&rsquo;s probably easier to do, since Scala plugin for Intellij is like alpha stage).</p>

<p>And that&rsquo;s it. This is the first &lsquo;real&rsquo; learning since I finished university, but this time it&rsquo;s for the good cause :) I hope everyone enjoys the course and I really hope that my skills in functional programming will benefit from the it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/09/twittory-lessons-learned-dont-mock-iterator.html">Twittory Lessons Learned - Don&#8217;t Mock Iterator</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-14T11:40:00+02:00" pubdate data-updated="true">Sep 14<span>th</span>, 2012</time>
        
         | <a href="/2012/09/twittory-lessons-learned-dont-mock-iterator.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><del>So I&rsquo;m doing this pet project now called <a href="https://github.com/pbuda/twittory">Twittory</a> and because it&rsquo;s hosted on Github, people can review it and voice their oppinions.</del><strong>Update (03 Feb 2013): I no longer develop this project.</strong></p>

<p>Marcin Deryło (<a href="https://twitter.com/marcinderylo">twitter</a>, <a href="http://marcinderylo.blogspot.com/">blog</a>), a friend of mine, has recently reviewed some simple tests already present in the project and he raised an issue with mocking iterators.</p>

<p>I&rsquo;ve had a very simple method which iterated over a collection returned by Twitter4J API. To do that, I simply mocked an Iterator and it&rsquo;s hasNext() and next() methods (using Mockito it&rsquo;s really simple anyway):</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">returns_details_only_for_tweets_with_links</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Status</span> <span class="n">status1</span> <span class="o">=</span> <span class="n">prepareStatus</span><span class="o">(</span><span class="s">&quot;Status 1&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Status</span> <span class="n">status2</span> <span class="o">=</span> <span class="n">prepareStatus</span><span class="o">(</span><span class="s">&quot;Text with link http://www.onet.pl in it&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Status</span> <span class="n">status3</span> <span class="o">=</span> <span class="n">prepareStatus</span><span class="o">(</span><span class="s">&quot;Status 3&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">ResponseList</span><span class="o">&lt;</span><span class="n">Status</span><span class="o">&gt;</span> <span class="n">mockResponse</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="n">ResponseList</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Iterator</span> <span class="n">mockIterator</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="n">Iterator</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">when</span><span class="o">(</span><span class="n">mockIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">thenReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">thenReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">thenReturn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>    <span class="n">when</span><span class="o">(</span><span class="n">mockIterator</span><span class="o">.</span><span class="na">next</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">status1</span><span class="o">).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">status2</span><span class="o">).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">status3</span><span class="o">);</span>
</span><span class='line'>    <span class="n">when</span><span class="o">(</span><span class="n">mockResponse</span><span class="o">.</span><span class="na">iterator</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">mockIterator</span><span class="o">);</span>
</span><span class='line'>    <span class="n">when</span><span class="o">(</span><span class="n">twitter</span><span class="o">.</span><span class="na">getHomeTimeline</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">mockResponse</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">LinkDetails</span><span class="o">&gt;</span> <span class="n">scan</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">scan</span><span class="o">();</span>
</span><span class='line'>    <span class="n">assertNotNull</span><span class="o">(</span><span class="n">scan</span><span class="o">);</span>
</span><span class='line'>    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">scan</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But said friend of mine suggested to drop mocking here in favor of actually returning a real iterator:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">returns_details_only_for_tweets_with_links</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Status</span> <span class="n">status1</span> <span class="o">=</span> <span class="n">prepareStatus</span><span class="o">(</span><span class="s">&quot;Status 1&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Status</span> <span class="n">status2</span> <span class="o">=</span> <span class="n">prepareStatus</span><span class="o">(</span><span class="s">&quot;Text with link http://www.onet.pl in it&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Status</span> <span class="n">status3</span> <span class="o">=</span> <span class="n">prepareStatus</span><span class="o">(</span><span class="s">&quot;Status 3&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">ResponseList</span><span class="o">&lt;</span><span class="n">Status</span><span class="o">&gt;</span> <span class="n">mockResponse</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="n">ResponseList</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">when</span><span class="o">(</span><span class="n">mockResponse</span><span class="o">.</span><span class="na">iterator</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">status1</span><span class="o">,</span> <span class="n">status2</span><span class="o">,</span> <span class="n">status3</span><span class="o">).</span><span class="na">iterator</span><span class="o">());</span>
</span><span class='line'>    <span class="n">when</span><span class="o">(</span><span class="n">twitter</span><span class="o">.</span><span class="na">getHomeTimeline</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">mockResponse</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">LinkDetails</span><span class="o">&gt;</span> <span class="n">scan</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">scan</span><span class="o">();</span>
</span><span class='line'>    <span class="n">assertNotNull</span><span class="o">(</span><span class="n">scan</span><span class="o">);</span>
</span><span class='line'>    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">scan</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pretty slick, eh? Saves code and complexity while becoming much more readable at the same time.</p>

<p>Learning FTW.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/04/scalawebsocket.html">ScalaWebSocket</a>
      </li>
    
      <li class="post">
        <a href="/2013/02/trying-to-deploy-scala-app-on-openshift.html">Trying to deploy Scala app on OpenShift</a>
      </li>
    
      <li class="post">
        <a href="/2013/02/angularjs-directive-for-password-matching.html">Angular directive for password matching</a>
      </li>
    
      <li class="post">
        <a href="/2013/02/my-first-month-at-softwaremill.html">My first month at SoftwareMill</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/scala-and-android-asynctask-implementation-problem.html">Scala and Android: AsyncTask implementation problem</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/pbuda">@pbuda</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'pbuda',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Piotr Buda -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'piotrbuda';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
